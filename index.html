<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>海龜華容道</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f8ff; }
    h1 { margin-top: 10px; }
    #menu button { margin: 10px; padding: 10px 20px; font-size: 16px; }
    #puzzle { display: grid; margin: 20px auto; gap: 2px; }
    .tile {
      width: 100px; height: 100px;
      background-size: cover; 
      background-position: center; 
      cursor: pointer; 
      border: 1px solid #ccc;
    }
    .hidden { display: none; }
    #infoBox {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white; padding: 20px; border: 2px solid #333;
      width: 300px; z-index: 100;
    }
    #infoBox button { margin-top: 10px; padding: 5px 15px; }
  </style>
</head>
<body>
  <h1>海龜華容道</h1>
  <div id="menu">
    <p>選擇拼圖大小：</p>
    <button onclick="startGame(2)">2×2</button>
    <button onclick="startGame(3)">3×3</button>
  </div>
  
  <div id="puzzle"></div>
  
  <div id="infoBox" class="hidden">
    <h2 id="turtleName"></h2>
    <p id="turtleDesc"></p>
    <button onclick="closeInfo()">關閉</button>
  </div>

<script>
const turtles = [
  { name: "綠蠵龜", img: "green.jpg", desc: "綠蠵龜主要以海草為食，是最常見的大型海龜之一。" },
  { name: "赤蠵龜", img: "loggerhead.jpg", desc: "赤蠵龜以頭大著稱，主要捕食甲殼類和軟體動物。" },
  { name: "玳瑁", img: "hawksbill.jpg", desc: "玳瑁有美麗的龜甲花紋，常以海綿為食。" },
  { name: "欖蠵龜", img: "olive.jpg", desc: "欖蠵龜體型較小，會集體上岸產卵，場面壯觀。" },
  { name: "革龜", img: "leatherback.jpg", desc: "革龜是世界上最大的海龜，以水母為主要食物。" }
];

let gridSize, puzzleDiv, emptyPos, tiles, turtle;

function startGame(size) {
  gridSize = size;
  turtle = turtles[Math.floor(Math.random()*turtles.length)];
  puzzleDiv = document.getElementById("puzzle");
  puzzleDiv.innerHTML = "";
  puzzleDiv.style.gridTemplateColumns = `repeat(${size}, 100px)`;
  puzzleDiv.style.gridTemplateRows = `repeat(${size}, 100px)`;

  let order = Array.from(Array(size*size).keys());
  order.sort(() => Math.random()-0.5);

  tiles = [];
  for (let i=0; i<size*size; i++) {
    let tile = document.createElement("div");
    tile.className = "tile";
    let row = Math.floor(order[i]/size);
    let col = order[i]%size;
    tile.dataset.correct = `${row},${col}`;
    tile.dataset.pos = `${Math.floor(i/size)},${i%size}`;
    tile.style.gridRowStart = Math.floor(i/size)+1;
    tile.style.gridColumnStart = i%size+1;

    if (order[i] === size*size-1) {
      tile.style.background = "#eee";
      emptyPos = tile.dataset.pos;
    } else {
      tile.style.backgroundImage = `url(${turtle.img})`;
      tile.style.backgroundSize = `${size*100}px ${size*100}px`;
      tile.style.backgroundPosition = `-${col*100}px -${row*100}px`;
      tile.addEventListener("click", () => moveTile(tile));
    }
    puzzleDiv.appendChild(tile);
    tiles.push(tile);
  }
}

function moveTile(tile) {
  let [tr, tc] = tile.dataset.pos.split(",").map(Number);
  let [er, ec] = emptyPos.split(",").map(Number);

  if ((Math.abs(tr-er)+Math.abs(tc-ec))===1) {
    tile.style.gridRowStart = er+1;
    tile.style.gridColumnStart = ec+1;
    tile.dataset.pos = `${er},${ec}`;
    emptyPos = `${tr},${tc}`;
    checkWin();
  }
}

function checkWin() {
  for (let tile of tiles) {
    if (tile.style.background==="") continue;
    if (tile.dataset.correct !== tile.dataset.pos) return;
  }
  showInfo();
}

function showInfo() {
  document.getElementById("turtleName").innerText = turtle.name;
  document.getElementById("turtleDesc").innerText = turtle.desc;
  document.getElementById("infoBox").classList.remove("hidden");
}

function closeInfo() {
  document.getElementById("infoBox").classList.add("hidden");
  document.getElementById("menu").style.display = "block";
  document.getElementById("puzzle").innerHTML = "";
}
</script>
</body>
</html>
